---
- hosts: all
  connection: local
  sudo: yes

  roles:
    - common
    - hhvm
    - php-fpm
    - memcached
    - percona
    - nginx
    - wp-cli
    - varnish
    - {
        role: wordpress,
        enviro: "{{ default_wp.enviro }}",
        domain: "{{ default_wp.hhvm_domains[0] }}",
        tags: [ 'wordpress' ]
      }
    - {
        role: listener,
        enviro: "{{ default_wp.enviro }}",
        backend: hhvm,
        domain: "{{ default_wp.hhvm_domains }}",
        tags: [ 'wordpress' ],
      }
    - {
        role: listener,
        enviro: "{{ default_wp.enviro }}",
        backend: php,
        domain: "{{ default_wp.php_domains }}",
        tags: [ 'wordpress' ],
        when: default_wp.php_domains is defined
      }
    - {
        role: wordpress,
        enviro: php,
        # Primary domain, used to setup WP SITEURL/HOME
        domain: [ "php.hgv.dev" ],
        tags: [ 'wordpress' ]
      }
    - {
        role: listener,
        enviro: php,
        backend: php,
        # All the domains to listen on for this backend
        domain: [ "php.hgv.dev" ],
        tags: [ 'wordpress' ]
      }
    - admin
    - xhprof

